#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>      
#include <unistd.h>     
#include <string.h>    
#include <errno.h>      

#define BUFFER_SIZE 1024

int main() {
    int fd; 
    char buffer[BUFFER_SIZE];
    ssize_t bytesRead, bytesWritten;

    fd = open("demo_file.txt", O_CREAT | O_WRONLY | O_TRUNC, 0644);
    if (fd == -1) {
        perror("Error opening/creating file");
        return EXIT_FAILURE;
    }

    printf("Enter text to write to the file: ");
    if (fgets(buffer, sizeof(buffer), stdin) == NULL) {
        printf("Error reading input.\n");
        close(fd);
        return EXIT_FAILURE;
    }

    bytesWritten = write(fd, buffer, strlen(buffer));
    if (bytesWritten == -1) {
        perror("Error writing to file");
        close(fd);
        return EXIT_FAILURE;
    }
    printf("Successfully wrote %zd bytes to the file.\n", bytesWritten);

    if (close(fd) == -1) {
        perror("Error closing file after writing");
        return EXIT_FAILURE;
    }
    fd = open("demo_file.txt", O_RDONLY);
    if (fd == -1) {
        perror("Error opening file for reading");
        return EXIT_FAILURE;
    }

    bytesRead = read(fd, buffer, sizeof(buffer) - 1);
    if (bytesRead == -1) {
        perror("Error reading from file");
        close(fd);
        return EXIT_FAILURE;
    }
    buffer[bytesRead] = '\0'; // Null-terminate the string

    printf("File contents:\n%s", buffer);

    if (close(fd) == -1) {
        perror("Error closing file after reading");
        return EXIT_FAILURE;
    }

    return EXIT_SUCCESS;
}
